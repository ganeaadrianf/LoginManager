<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <startup> 
        <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.6" />
    </startup>

  <connectionStrings>
    <clear />
    <!--poate fi schimbat cu username parola, ca in exemplu-->
    <!--Data Source=sharepoint;Initial Catalog=master;Integrated Security=false;User Id=ganea.adrian;Password=parola;-->
    <add name="AdminAplicConnectionString"
     providerName="System.Data.SqlClient"
     connectionString="Data Source=sharepoint;Initial Catalog=z_AdminAplic;Integrated Security=SSPI" />
  
    <!--Serverele de baze de date trebuie sa contine SqlServer urmate de un numar intreg, numarul lor trebuie sa coincida cu valoarea din tag-ul NumberOfSQLServers-->
    <add name="SqlServer1"
       providerName="System.Data.SqlClient"
       connectionString="Data Source=sharepoint;Initial Catalog=master;Integrated Security=SSPI" />

    
  </connectionStrings>
  

  <appSettings>
    <add key="NumberOfSQLServers" value="1"/>
    <!--SQL QUERIES-->
    
      <!--Incarca gridul persoane din adminaplic, trebuie pastrat aliasul coloanelor, ATENTIE SI LA WHERE--> 
      <add key="QueryUsers" value="SELECT top 30 u.[Numeadi] as Nume,u.[Prenume] as Prenume,u.[CNP] as CNP,u.[Login] as Login,u.[C1] as C1,u.[C2] as C2,u.[C3] as C3,u.[C4] as C4,u.[C5] as C5,u.[C6] as C6,u.[C7] as C7,u1.Denumire,u2.denumire,u3.denumire,u4.Denumire,u5.denumire,u6.denumire,u7.denumire FROM Users u left join UM u1 on u.C1=u1.ID left join UM u2 on u.C2=u2.ID left join UM u3 on u.C3=u3.ID left join UM u4 on u.C4=u4.ID left join UM u5 on u.C5=u5.ID left join UM u6 on u.C6=u6.ID left join UM u7 on u.C7=u7.ID WHERE (isnull(u.Login,'') LIKE '{0}%' OR isnull(u.CNP,'') LIKE '{0}%' or isnull(u.Numeadi,'') like '{0}%') AND( (u1.id={1} or isnull(u1.denumire,'') like '%{8}%') and (u2.id={2} or isnull(u2.denumire,'') like '%{9}%') and (u3.id={3} or isnull(u3.denumire,'') like '%{10}%') and (u4.id={4} or isnull(u4.denumire,'') like '%{11}%') and (u5.id={5} or isnull(u5.denumire,'') like '%{12}%') and (u6.id={6} or isnull(u6.denumire,'') like '%{13}%') and (u7.id={7} or isnull(u7.denumire,'') like '%{14}%') ) order by CNP desc; "/>
    
      <!--Insereaza user in adminaplic, trebuie mentinuta ordinea coloanelor-->
      <add key="InsertUser" value="INSERT USERS([Numeadi],[Prenume],[CNP],[Login],[C1],[C2],[C3],[C4],[C5],[C6],[C7]) VALUES('{0}','{1}','{2}','{3}',{4},{5},{6},{7},{8},{9},{10}); "/>
    
      <!--Verifica daca exista userul in adminaplic--> 
      <add key="CheckIfUserExists" value="SELECT TOP 10 * FROM USERS U where login='{0}'; "/>
    
      <!--Update user din adminaplic, trebuie mentinuta ordinea coloanelor-->
      <add key="UpdateUser" value="Update USERS set [Numeadi]='{0}',[Prenume]='{1}',[CNP]='{2}',[Login]='{3}',[C1]={4},[C2]={5},[C3]={6},[C4]={7},[C5]={8},[C6]={9},[C7]={10} where login='{3}'"/>
    
      <!--Delete user din adminaplic-->
      <add key="DeleteUser" value="DELETE USERS where login='{0}'; "/>

      <!--Incarca permisiunile unui user din adminaplic-->
      <add key="QueryUserRoles" value="SELECT [Login] as Loginadi,Aplicatie as Aplicatie, TipAcces as TipAcces FROM UserRoles u WHERE login='{0}'; "/>
      <!--Sterge permisiunea unui user din adminaplic-->
      <add key="DeleteUserRole" value="DELETE USERROLES where login='{0}' and Aplicatie='{1}' and TipAcces='{2}'; "/>

      <!--Adauga permisiune user in adminaplic-->
      <add key="InsertUserRole" value="Insert USERROLES([Login],[Aplicatie],[TipAcces]) Values ('{0}','{1}','{2}'); "/>
    
    
      <!--Incarca nomenclatoarele de departamente-->
      <add key="CList" value="SELECT ID as Valoare,Denumire as Denumire from UM; "/>
      <add key="C1List" value="SELECT ID as Valoare,Denumire as Denumire from UM; "/>
      <add key="C2List" value="SELECT ID as Valoare,Denumire as Denumire from UM; "/>
      <add key="C3List" value="SELECT ID as Valoare,Denumire as Denumire from UM;  "/>
      <add key="C4List" value="SELECT ID as Valoare,Denumire as Denumire from UM;  "/>
      <add key="C5List" value="SELECT ID as Valoare,Denumire as Denumire from UM; "/>
      <add key="C6List" value="SELECT ID as Valoare,Denumire as Denumire from UM;  "/>
      <add key="C7List" value="SELECT ID as Valoare,Denumire as Denumire from UM;  "/>
    
    
      <!--Lista aplicatiilor, se poate folosi un view din baza de date daca exista informatia
      Setul rezultat trebuie sa aibe 3 coloane: DBServer,DBName,AppName - DBName este numele bazei de date, AppName este numele aplicatiei in admin aplic, iar DBServer este unul dintre SqlServer1,...-->
      <add key="AplicatieList" value="SELECT 'SqlServer1' as DBServer,'z_AdminAplic' as DBName,'Aplicatie 1' as AppName union Select 'SqlServer1','aspnetdb','Aplicatie 2'; "/>

      <!--Lista tipurilor de access pe aplicatii, se poate folosi un view din baza de date daca exista informatia
      Setul rezultat trebuie sa aiba 2 coloane: Label - este denumirea rolului din adminaplic, iar DBRole este denumirea rolului din SQL-->
      <add key="TipAccesList" value="SELECT 'R' as Label,'Reader' as DBRole union Select 'U','Writer'; "/> <!--read si update-->

   
    
    <!--SQL LOGINS -STANDARD, nu ar trebui schimbate-->    
      <add key="CheckIfLoginExists" value="select loginname from master.dbo.syslogins where loginname='{0}';"/>
      <add key="CreateLogin" value="CREATE LOGIN [{0}] WITH PASSWORD = '{1}';"/>
      <add key="ResetLogin" value="ALTER LOGIN [{0}] WITH PASSWORD = '{1}';"/>
      <add key="DropLogin" value=" DROP LOGIN [{0}];"/>
    <!--SQL USERS -STANDARD, nu ar trebui schimbate-->
      <add key="CheckIfUserMappedToRole" value="select 1 from sys.database_role_members drm join sys.database_principals rp on (drm.role_principal_id = rp.principal_id) join sys.database_principals mp on (drm.member_principal_id = mp.principal_id)    where  mp.name='{0}' and rp.name='{1}';"/>
      <add key="CreateDBUserForLogin" value="CREATE USER [{0}] FOR LOGIN [{0}] ;"/>
      <add key="AlterUserWithLogin" value=" ALTER USER [{0}] WITH LOGIN = [{0}];"/>
  
    <add key="AddRoleMember" value="EXEC sp_addrolemember '{0}', '{1}';"/>
      <add key="DropRoleMember" value="EXEC sp_droprolemember '{0}', '{1}';"/>

    
  </appSettings>
  
  
</configuration>